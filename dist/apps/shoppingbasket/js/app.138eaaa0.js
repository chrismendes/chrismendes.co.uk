!function(){"use strict";function a(){this.items=[],this.subtotal=0,this.vat=0,this.vatRate=20,this.total=0}a.prototype.addItem=function(a,b,c,d,e){this.items.push({id:a,name:b,size:c,price:d,quantity:e,cost:(d*e).toFixed(2)})},a.prototype.removeItem=function(a){var b=this._findItem(a);return b===!1?!1:(this.items.splice(b,1),!0)},a.prototype.setItemQuantity=function(a,b,c){var d=this._findItem(a);if(d===!1)return!1;var e=this.items[d];return b=parseInt(b),this.items[d].quantity=c===!0?e.quantity+b:b,this.items[d].cost=(e.price*e.quantity).toFixed(2),this.items[d].cost},a.prototype.getItemQuantity=function(a){var b=this._findItem(a);return b===!1?!1:this.items[b].quantity},a.prototype.updateFooterTotals=function(){for(var a=0,b=0;b<this.items.length;b++)a+=parseFloat(this.items[b].cost);this.subtotal=a.toFixed(2),this.vat=this._calculateVAT(),this.total=(parseFloat(this.subtotal)+parseFloat(this.vat)).toFixed(2)},a.prototype.getBasketData=function(){return{items:this.items,subtotal:this.subtotal,vat:this.vat,vatRate:this.vatRate,total:this.total}},a.prototype._findItem=function(a){var b=$.map(this.items,function(a){return a.id}).indexOf(parseInt(a));return b>-1?b:!1},a.prototype._calculateVAT=function(){if(this.vatRate){var a=this.subtotal*(this.vatRate/100);return a.toFixed(2)}},window.App=window.App||{},window.App.Models=window.App.Models||{},window.App.Models.Basket=a}(),function(){"use strict";function a(a,b){this.model=a,this.view=b,this.error=!1,this.basketDisabled=!1,this.dataSubmitURL="",this.model.items.length>0&&this.model.updateFooterTotals(),this.view.render(this.model.getBasketData()),this.bindEvents()}a.prototype.bindEvents=function(){var a=this;this.view.bind("removeItem",function(b){a.removeItem(b)}),this.view.bind("quantityUp",function(b){a.quantityUpDown(b,1)}),this.view.bind("quantityDown",function(b){a.quantityUpDown(b,-1)}),this.view.bind("editQuantity",function(b,c){a.editQuantity(b,c)}),this.view.bind("checkout",function(){a.checkout()})},a.prototype.removeItem=function(a){if(this.basketDisabled||this.error)return!1;var b=this.model.removeItem(a);b!==!1&&(this.view.removeItem(a),this._updateFooterTotals(),this.view.setBasketEmptyState(0===this.model.items.length?!0:!1))},a.prototype.editQuantity=function(a,b){if(this.basketDisabled)return!1;var c=new RegExp("^[0-9]+$"),d=c.test(b);if(d===!1||1>b||b>10)return this.error=!0,this.view.setQuantityErrorState(a,"on"),!1;this.error=!1,this.view.setQuantityErrorState(a,"off");var e=this.model.setItemQuantity(a,b);this.view.setItemCost(a,e),this._updateFooterTotals()},a.prototype.quantityUpDown=function(a,b){if(this.basketDisabled)return!1;var c=this.model.getItemQuantity(a);if(0>b&&2>c||b>0&&c>9)return!1;this.error=!1,this.view.setQuantityErrorState(a,"off"),this.view.quantityUpDown(a,c,b);var d=this.model.setItemQuantity(a,b,!0);this.view.setItemCost(a,d),this._updateFooterTotals()},a.prototype.checkout=function(){if(this.basketDisabled||this.error)return!1;if(this.model.items.length>0){this.basketDisabled=!0,this.view.setCheckoutProcessingState("on");var a=this.model.getBasketData();App.Services.httpSendJSON(a,this.dataSubmitURL)}},a.prototype._updateFooterTotals=function(){this.model.updateFooterTotals(),this.view.updateFooterTotals({subtotal:this.model.subtotal,vat:this.model.vat,total:this.model.total})},window.App=window.App||{},window.App.Controller=a}(),function(){"use strict";function a(){this.selectors={template:"#template-basket",stage:".js-basket",basketItem:".js-item",itemQuantity:".js-item-quantity",quantityUpBtn:".js-item-quantity-plus",quantityDownBtn:".js-item-quantity-minus",itemCost:".js-item-cost",removeItemBtn:".js-item-remove",subtotal:".js-subtotal",vat:".js-vat",total:".js-total",msgQuantityError:".js-msg-quantity-error",helpTextDefault:".js-helptext-default",helpTextEmpty:".js-helptext-empty",checkoutBtn:".js-continue"},this.currencySymbol="&pound;"}a.prototype.render=function(a){var b=$(this.selectors.template).html(),c=Handlebars.compile(b)(a);$(this.selectors.stage).html(c)},a.prototype.bind=function(a,b){var c=this;"removeItem"===a&&$(this.selectors.removeItemBtn).click(function(a){a.preventDefault();var d=c._getClickedItemID(this);b(d)}),"editQuantity"===a&&$(this.selectors.itemQuantity).change(function(){var a=c._getClickedItemID(this),d=c.getItemQuantity(a);b(a,d)}),"quantityUp"===a&&$(this.selectors.quantityUpBtn).click(function(a){a.preventDefault();var d=c._getClickedItemID(this);b(d)}),"quantityDown"===a&&$(this.selectors.quantityDownBtn).click(function(a){a.preventDefault();var d=c._getClickedItemID(this);b(d)}),"checkout"===a&&$(this.selectors.checkoutBtn).click(function(a){a.preventDefault(),b()})},a.prototype.removeItem=function(a){if("undefined"!=typeof a){var b=$(this.selectors.basketItem+'[data-id="'+a+'"]');b.addClass("is-removed")}},a.prototype.quantityUpDown=function(a,b,c){if("undefined"!=typeof a&&"undefined"!=typeof c){var d=this._getItemUIElement(a,"quantity"),e=b+c;d.val(e)}},a.prototype.setQuantity=function(a,b){if("undefined"!=typeof a&&"undefined"!=typeof b){var c=this._getItemUIElement(a,"quantity");c.val(b)}},a.prototype.setQuantityErrorState=function(a,b){if("undefined"!=typeof a){var c=this._getItemUIElement(a,"quantity");"on"===b?(c.addClass("is-error"),$(this.selectors.msgQuantityError).removeClass("is-hidden"),this._setCheckoutButton("off")):"off"===b&&(c.removeClass("is-error"),$(this.selectors.msgQuantityError).addClass("is-hidden"),this._setCheckoutButton("on"))}},a.prototype.getItemQuantity=function(a){if("undefined"!=typeof a){var b=this._getItemUIElement(a,"quantity");return b.val()}},a.prototype.setItemCost=function(a,b){if("undefined"!=typeof a&&"undefined"!=typeof b){var c=this._getItemUIElement(a,"cost");c.html(this.currencySymbol+b)}},a.prototype.updateFooterTotals=function(a){"undefined"!=typeof a.subtotal&&$(this.selectors.subtotal).html(this.currencySymbol+a.subtotal),"undefined"!=typeof a.vat&&$(this.selectors.vat).html(this.currencySymbol+a.vat),"undefined"!=typeof a.total&&$(this.selectors.total).html(this.currencySymbol+a.total)},a.prototype.setBasketEmptyState=function(a){"undefined"!=typeof a&&(a===!0?($(this.selectors.helpTextDefault).addClass("is-hidden"),$(this.selectors.helpTextEmpty).removeClass("is-hidden"),this._setCheckoutButton("off")):a===!1&&($(this.selectors.helpTextDefault).removeClass("is-hidden"),$(this.selectors.helpTextEmpty).addClass("is-hidden"),this._setCheckoutButton("on")))},a.prototype.setCheckoutProcessingState=function(a){"undefined"!=typeof a&&"on"===a&&(this._setCheckoutButton("loading"),$(this.selectors.stage).addClass("is-disabled"),$(this.selectors.itemQuantity).attr("disabled",!0))},a.prototype._setCheckoutButton=function(a){"undefined"!=typeof a&&("on"===a?$(this.selectors.checkoutBtn).removeClass("is-disabled"):"off"===a?$(this.selectors.checkoutBtn).addClass("is-disabled"):"loading"===a&&($(this.selectors.checkoutBtn).addClass("is-disabled"),$(this.selectors.checkoutBtn).html("Processing...")))},a.prototype._getClickedItemID=function(a){var b=$(a).parents(this.selectors.basketItem).attr("data-id");return"undefined"==typeof b?!1:b},a.prototype._getItemUIElement=function(a,b){var c=$(this.selectors.basketItem+'[data-id="'+a+'"]');return"quantity"===b&&(b=c.find(this.selectors.itemQuantity)),"cost"===b&&(b=c.find(this.selectors.itemCost)),b.length?b:!1},window.App=window.App||{},window.App.Views=window.App.Views||{},window.App.Views.Basket=a}(),function(){"use strict";window.App=window.App||{},window.App.Services=window.App.Services||{},window.App.Services.httpSendJSON=function(a,b){var c=JSON.stringify(a);$.ajax({url:b,type:"POST",data:c,dataType:"json",error:function(){window.console&&console.info("Basket data sent as follows:\n"+c),alert("Basket data sent as follows:\n\n"+c)},success:function(){}})},Handlebars.registerHelper("decimalPlaces",function(a){return"string"==typeof a&&(a=parseFloat(a)),a.toFixed(2)}),Handlebars.registerHelper("everyOther",function(a,b,c){return++a%b?c.inverse(this):c.fn(this)})}(),function(){"use strict";function a(){this.init=function(){this.model=new App.Models.Basket,this.view=new App.Views.Basket,this.model.addItem(1,"Cotton T-Shirt","Medium",1.99,1),this.model.addItem(2,"Baseball Cap","One Size",2.99,1),this.model.addItem(3,"Swim Shorts","Medium",3.99,1),this.controller=new App.Controller(this.model,this.view)}}var b=new a;"undefined"!=typeof window.addEventListener?window.addEventListener("load",b.init()):window.attachEvent("onload",b.init)}();